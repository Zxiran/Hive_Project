# load file into hdfs from local

#File 1
 hadoop fs -put /home/cloudera/testdir/project_files/AgentLogingReport.csv /user/cloudera/project_1/

#File 2
hadoop fs -put /home/cloudera/testdir/project_files/AgentPerformance.csv /user/cloudera/project_1/

# Create hive table for agentlogingreport
 create table temp_agent_loging_report
    (
     sr_no int,
     agent string,
     date string,
     login_time string,
     logout_time string,
     duration string
     )
     row format delimited
     fields terminated by ','
    stored as textfile;
    
# Create hive table for agentperformancereport
create external table temp_agent_performance
     (
     sr_no int,
     date string,
     agent string,
     total_chats int,
     avg_response_time string,
     avg_res_time string,
     avg_rating float,
     feedback int
     )
     row format delimited
     fields terminated by ','
     location 'hdfs:///user/cloudera/project_1/file_2'
     tblproperties('skip.header.line.count'='1');
    
# List of all agents' names.
  insert overwrite local directory '/home/cloudera/testdir/project_1/agent_names'
  select DISTINCT agent from temp_agent_loging_report;
  
  
# Find out agent average rating.

   insert overwrite local directory '/home/cloudera/testdir/project_1/agent_avg_rating'
     row format delimited
     fields terminated by '\t'
     select agent, avg(avg_rating) as overall_avg_rating from temp_agent_performance
     GROUP BY agent;
     
5. Total working days for each agents

     insert overwrite local directory '/home/cloudera/testdir/project_1/total_working_days'
     row format delimited
     fields terminated by ','
     stored as textfile
     select  agent ,COUNT(DISTINCT date)  from orc_agent_loging_report
     GROUP BY agent;
     
6. Total query that each agent have taken

     insert overwrite local directory '/home/cloudera/testdir/project_1/total_agent_query'
     row format delimited
     fields terminated by ':'
     stored as textfile
     select agent ,sum(total_chats) from temp_agent_performance
     GROUP BY agent;
     
7. Total Feedback that each agent have received
    insert overwrite local directory '/home/cloudera/testdir/project_1/agent_total_feedback'
     row format delimited
     fields terminated by ':'
     stored as textfile
     select agent ,sum(feedback) from temp_agent_performance
     GROUP BY agent;
     
8. Agent name who have average rating between 3.5 to 4

     insert overwrite local directory '/home/cloudera/testdir/project_1/agent_rating_3dot5_to_4'
     row format delimited
     fields terminated by ':'
     stored as textfile
     select agent,avg(avg_rating) as avg_rating from temp_agent_performance
     GROUP BY agent
     HAVING avg(avg_rating)>= 3.5 AND avg(avg_rating)<=4;

  
  
